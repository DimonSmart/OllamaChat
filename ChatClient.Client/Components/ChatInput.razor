@using Microsoft.AspNetCore.Components.Web

<MudTextField T="string"
              @bind-Value="CurrentText"
              DebounceInterval="200"
              Lines="3"
              Label="Type your message"
              Variant="Variant.Outlined"
              Class="mt-2"
              Adornment="Adornment.End"
              AdornmentIcon="@Icons.Material.Filled.Send"
              AdornmentColor="Color.Primary"
              OnAdornmentClick="SendMessage"
              OnKeyDown="HandleKeyDown" />

@code {
    [Parameter] public EventCallback<string> OnSend { get; set; }
    private string CurrentText { get; set; } = string.Empty;
    private bool IsSending { get; set; } = false;
    private bool IsTextEntered => !string.IsNullOrWhiteSpace(CurrentText);
    private bool IsSendDisabled => IsSending || !IsTextEntered;
    private async Task HandleKeyDown(KeyboardEventArgs e)
    {
        if (e.Key == "Enter" && e.CtrlKey && !IsSendDisabled)
        {
            await SendMessage();
        }
    }

    private async Task SendMessage()
    {
        if (IsSendDisabled) return;
        try
        {
            IsSending = true;
            var textToSend = CurrentText.Trim();
            CurrentText = string.Empty;
            await OnSend.InvokeAsync(textToSend);
        }
        finally
        {
            IsSending = false;
        }
    }
}
